# This file contains almost everything you need to run
# tectonic-console on your cluster! You'll also need to
# get a pull secret from tectonic.com so you can authorize
# your cluster to pull the container image for the console.
# The pull secret should be named "coreos-pull-secret"
# and be installed in the default namespace.
apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: tectonic-console
  labels:
    app: tectonic-console
    component: ui
spec:
  replicas: 1
  template:
    metadata:
      name: tectonic-console
      labels:
        app: tectonic-console
        component: ui
    spec:
      containers:
      - name: tectonic-console
        image: quay.io/coreos/tectonic-console:v0.2.0
        imagePullPolicy: IfNotPresent
        command: ["/opt/bridge/bin/bridge"]
        ports:
        - containerPort: 9000
          protocol: TCP
        env:
        - name: BRIDGE_K8S_MODE
          value: "in-cluster"
        - name: BRIDGE_K8S_AUTH
          value: "service-account"
        - name: BRIDGE_HOST
          value: "http://example.com/dummy-value"
        - name: BRIDGE_USER_AUTH
          value: "disabled"
        - name: BRIDGE_PUBLIC_DIR
          value: /opt/bridge/static
        - name: BRIDGE_IDENTITY_FILE
          value: /etc/coreos-pull-secret/.dockercfg
        - name: BRIDGE_LISTEN
          value: "http://0.0.0.0:9000"
        - name: BRIDGE_PUBLIC_DIR
          value: "/opt/bridge/static"
        - name: BRIDGE_TECTONIC_VERSION
          value: "1.3.0"
        resources:
          requests:
            cpu: 100m
            memory: 50Mi
          limits:
            cpu: 100m
            memory: 50Mi
        volumeMounts:
        - name: coreos-pull-secret
          mountPath: /etc/coreos-pull-secret
          readOnly: true
      volumes:
      - name: coreos-pull-secret
        secret:
          secretName: coreos-pull-secret
      imagePullSecrets:
      - name: coreos-pull-secret
